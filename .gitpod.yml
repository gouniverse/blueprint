# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

tasks:
  - name: Install Taskfile
    command: go install github.com/go-task/task/v3/cmd/task@latest

  - name: Install the GCloud CLI
    init: | 
      sudo apt-get install -y apt-transport-https ca-certificates gnupg
      curl -O https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-cli-444.0.0-linux-x86_64.tar.gz
      tar -xf google-cloud-cli-444.0.0-linux-x86_64.tar.gz
    command: ./google-cloud-sdk/install.sh --path-update=true --quiet

  - name: Install Air
    # binary will be $(go env GOPATH)/bin/air
    # command: curl -sSfL https://raw.githubusercontent.com/cosmtrek/air/master/install.sh | sh -s -- -b $(go env GOPATH)/bin
    # or install it into ./bin/
    # command: curl -sSfL https://raw.githubusercontent.com/cosmtrek/air/master/install.sh | sh -s
    command: go install github.com/cosmtrek/air@latest

  - name: Prepare .env file
    command: cp .env_example .env

  - name: Install Dependencies and Run
    init: go get && go build ./... && go test ./...
    command: go run